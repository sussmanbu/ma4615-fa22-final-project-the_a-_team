
---
title: Analysis
description:
toc: true
featuredImage: /images/The_Big_Picture_2.jpeg
featuredVideo:
draft: false
---

```{r}
library(here)
library(tidyverse)
library(dplyr)
library(AICcmodavg)
library(ggcorrplot)
library(ggplot2)


co2_data <- read_csv("owid-co2-data.csv", show_col_types = FALSE)

co2_data1 <- co2_data %>%
   select(country, year, population, gdp, energy_per_capita, energy_per_gdp, primary_energy_consumption, total_ghg) %>%
  na.omit() 

co2_data1
write_csv(co2_data1, file = here::here("dataset", "co2_data1_clean.csv"))

save(co2_data1, file = here::here("co2_data1_clean.RData"))

model1 <- lm(total_ghg ~ population +gdp + energy_per_capita + energy_per_gdp + primary_energy_consumption, data = co2_data1)
summary(model1)
plot(total_ghg ~ population +gdp + energy_per_capita + energy_per_gdp + primary_energy_consumption, data= co2_data1)

modAIC <- MASS::stepAIC(model1, k = 2)
modBIC <- MASS::stepAIC(model1, k = log(nrow(co2_data1)))
co2_data2 <- co2_data1 %>%
  select(-country, -year, -total_ghg)
co2_data2

correlation_matrix <- round(cor(co2_data2),1)
corrp.mat <- cor_pmat(co2_data2)
ggcorrplot(correlation_matrix, method ="square")
```


```{r}
library(dplyr)
library(tidyverse)
Agri <- read_csv("FAOSTAT.csv", show_col_types = FALSE) 

Agri_land <- 
  Agri %>% 
  filter(str_detect(Item,"Emissions on agricultural land")) %>%
  filter(str_detect(Element, "CO2eq")) %>%
  mutate(unit = "tonnes") %>%
  select(Area, Item, Element, unit, Y1990:Y2018) %>%
  pivot_longer(c(Y1990:Y2018),
               names_to = "year", values_to = "emission") %>%
  mutate(total = emission * 1000) %>%
  select(-emission) %>%
  arrange(order(year)) %>%
  group_by(year, Item, Area) %>%
  summarize(sum_emission = sum(total, na.rm = TRUE, count = n()), Element) %>%
  rename(Country = Area, Emission = sum_emission, source_of_emissions = Item, `Element(tonnes)` = Element) %>%
  mutate(year = gsub("Y", "", year)) %>%
  select(-Country) %>%
  ungroup() %>%
  select(-`Element(tonnes)`)%>%
  group_by(Country,year, source_of_emissions) %>%
  summarise(Emissions = sum(Emission)) %>%
  rename(country = Country) %>%
  mutate(country = gsub("United Kingdom of Great Britain and Northern Ireland", "United Kingdom", country)) %>%
  mutate(country = gsub("United States of America", "United States", country)) %>%
  mutate(country = gsub("Russian Federation", "Russia", country)) %>%
  mutate(country = gsub("Bolivia (Plurinational State of)", "Bolivia", country)) %>%
  mutate(country = gsub("Republic of Moldova", "Moldova", country)) %>%
  mutate(country = gsub("Lao People's Democratic Republic", "Laos", country)) %>%
  mutate(country = gsub("Syrian Arab Republic", "Syria", country)) %>%
  mutate(country = gsub("United Republic of Tanzania", "Tanzania", country)) %>%
  mutate(country = gsub("Democratic Republic of the Congo", "Democratic Republic of Congo", country)) %>%
  mutate(country = gsub("Iran (Islamic Republic of)", "Iran", country))
Agri_land$year = as.numeric(Agri_land$year)
Agri_land
write_csv(Agri_land, file = here::here("dataset", "Agri_land_clean.csv"))


knitr::kable(head(Agri_land[, 1:4]), caption = "The CO2 emissions in agriculral usage in United States.", "simple")

```


```{r}
co2_agri <- full_join(co2_data1, Agri_land, by = c("year", "country"))
co2_agri

co2_agri <- co2_agri %>% 
  mutate(total_ghg2 = total_ghg * 1000) %>%
  select(-total_ghg) %>%
  rename(`Agriculture_emissions(kilotonnes)` = Emissions, `total_ghg(kilotonnes)` = total_ghg2)
co2_agri <- co2_agri %>% mutate(agri_ghg_total = rowSums(co2_agri[,c(9,10)])) %>% 
  na.omit()

co2_agri
  
write_csv(co2_agri, file = here::here("dataset", "co2_agri_clean.csv"))
save(co2_agri, file = here::here("dataset/co2_agri_clean.RData"))

```




