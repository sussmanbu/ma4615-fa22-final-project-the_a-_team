---
title: Analysis
description:
toc: true
featuredImage: /images/The_Big_Picture_2.jpeg
featuredVideo:
draft: false
---


<div id="TOC">

</div>

<pre class="r"><code>library(here)</code></pre>
<pre><code>## here() starts at /Users/lindasun/Desktop/MA415/ma4615-fa22-final-project-the_a-_team</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages
## ───────────────────────────────────────
## tidyverse 1.3.2 ──</code></pre>
<pre><code>## ✔ ggplot2 3.4.0      ✔ purrr   0.3.5 
## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
## ✔ tidyr   1.2.1      ✔ stringr 1.4.1 
## ✔ readr   2.1.3      ✔ forcats 0.5.2 
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(dplyr)
library(AICcmodavg)
library(ggcorrplot)
library(ggplot2)


co2_data &lt;- read_csv(&quot;owid-co2-data.csv&quot;, show_col_types = FALSE)

co2_data1 &lt;- co2_data %&gt;%
   select(country, year, population, gdp, energy_per_capita, energy_per_gdp, primary_energy_consumption, total_ghg) %&gt;%
  na.omit() 

co2_data1</code></pre>
<pre><code>## # A tibble: 4,628 × 8
##    country      year population         gdp energy_per…¹ energ…² prima…³ total…⁴
##    &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghanistan  1990   10694804 13065984000        2968.   2.43    31.7     9.58
##  2 Afghanistan  1991   10745168 12047362048        1294.   1.15    13.9     9.81
##  3 Afghanistan  1992   12057436 12677538816         760.   0.723    9.17    9.03
##  4 Afghanistan  1993   14003764  9834580992         650.   0.926    9.10    9.11
##  5 Afghanistan  1994   15455560  7919857152         570.   1.11     8.82    9.15
##  6 Afghanistan  1995   16418911 12307525632         452.   0.604    7.43    9.58
##  7 Afghanistan  1996   17106600 12070125568         426.   0.604    7.29   10.6 
##  8 Afghanistan  1997   17788818 11850752000         390.   0.585    6.94   11.6 
##  9 Afghanistan  1998   18493134 11692172288         365.   0.577    6.75   12.4 
## 10 Afghanistan  1999   19262854 11517317120         350.   0.586    6.75   13.3 
## # … with 4,618 more rows, and abbreviated variable names ¹​energy_per_capita,
## #   ²​energy_per_gdp, ³​primary_energy_consumption, ⁴​total_ghg</code></pre>
<pre class="r"><code>write_csv(co2_data1, file = here::here(&quot;dataset&quot;, &quot;co2_data1_clean.csv&quot;))

save(co2_data1, file = here::here(&quot;co2_data1_clean.RData&quot;))

model1 &lt;- lm(total_ghg ~ population +gdp + energy_per_capita + energy_per_gdp + primary_energy_consumption, data = co2_data1)
summary(model1)</code></pre>
<pre><code>## 
## Call:
## lm(formula = total_ghg ~ population + gdp + energy_per_capita + 
##     energy_per_gdp + primary_energy_consumption, data = co2_data1)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -944.81  -20.28   -7.98   21.41 1616.86 
## 
## Coefficients:
##                              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                 1.298e+01  3.491e+00   3.720 0.000202 ***
## population                  1.449e-06  2.115e-08  68.538  &lt; 2e-16 ***
## gdp                        -3.047e-11  3.713e-12  -8.207 2.92e-16 ***
## energy_per_capita          -8.262e-04  7.893e-05 -10.468  &lt; 2e-16 ***
## energy_per_gdp              3.592e+00  1.705e+00   2.107 0.035200 *  
## primary_energy_consumption  2.565e-01  2.314e-03 110.846  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 159.2 on 4622 degrees of freedom
## Multiple R-squared:  0.9918, Adjusted R-squared:  0.9918 
## F-statistic: 1.117e+05 on 5 and 4622 DF,  p-value: &lt; 2.2e-16</code></pre>
<pre class="r"><code>plot(total_ghg ~ population +gdp + energy_per_capita + energy_per_gdp + primary_energy_consumption, data= co2_data1)</code></pre>
<p><img src="/analysis_files/figure-html/unnamed-chunk-1-1.png" width="672" /><img src="/analysis_files/figure-html/unnamed-chunk-1-2.png" width="672" /><img src="/analysis_files/figure-html/unnamed-chunk-1-3.png" width="672" /><img src="/analysis_files/figure-html/unnamed-chunk-1-4.png" width="672" /><img src="/analysis_files/figure-html/unnamed-chunk-1-5.png" width="672" /></p>
<pre class="r"><code>modAIC &lt;- MASS::stepAIC(model1, k = 2)</code></pre>
<pre><code>## Start:  AIC=46935.94
## total_ghg ~ population + gdp + energy_per_capita + energy_per_gdp + 
##     primary_energy_consumption
## 
##                              Df Sum of Sq       RSS   AIC
## &lt;none&gt;                                    117156317 46936
## - energy_per_gdp              1    112494 117268811 46938
## - gdp                         1   1707111 118863428 47001
## - energy_per_capita           1   2777551 119933868 47042
## - population                  1 119069616 236225934 50179
## - primary_energy_consumption  1 311442118 428598436 52937</code></pre>
<pre class="r"><code>modBIC &lt;- MASS::stepAIC(model1, k = log(nrow(co2_data1)))</code></pre>
<pre><code>## Start:  AIC=46974.58
## total_ghg ~ population + gdp + energy_per_capita + energy_per_gdp + 
##     primary_energy_consumption
## 
##                              Df Sum of Sq       RSS   AIC
## - energy_per_gdp              1    112494 117268811 46971
## &lt;none&gt;                                    117156317 46975
## - gdp                         1   1707111 118863428 47033
## - energy_per_capita           1   2777551 119933868 47075
## - population                  1 119069616 236225934 50212
## - primary_energy_consumption  1 311442118 428598436 52969
## 
## Step:  AIC=46970.58
## total_ghg ~ population + gdp + energy_per_capita + primary_energy_consumption
## 
##                              Df Sum of Sq       RSS   AIC
## &lt;none&gt;                                    117268811 46971
## - gdp                         1   1859099 119127910 47035
## - energy_per_capita           1   3007458 120276269 47079
## - population                  1 120315789 237584600 50230
## - primary_energy_consumption  1 315600585 432869396 53006</code></pre>
<pre class="r"><code>co2_data2 &lt;- co2_data1 %&gt;%
  select(-country, -year, -total_ghg)
co2_data2</code></pre>
<pre><code>## # A tibble: 4,628 × 5
##    population         gdp energy_per_capita energy_per_gdp primary_energy_cons…¹
##         &lt;dbl&gt;       &lt;dbl&gt;             &lt;dbl&gt;          &lt;dbl&gt;                 &lt;dbl&gt;
##  1   10694804 13065984000             2968.          2.43                  31.7 
##  2   10745168 12047362048             1294.          1.15                  13.9 
##  3   12057436 12677538816              760.          0.723                  9.17
##  4   14003764  9834580992              650.          0.926                  9.10
##  5   15455560  7919857152              570.          1.11                   8.82
##  6   16418911 12307525632              452.          0.604                  7.43
##  7   17106600 12070125568              426.          0.604                  7.29
##  8   17788818 11850752000              390.          0.585                  6.94
##  9   18493134 11692172288              365.          0.577                  6.75
## 10   19262854 11517317120              350.          0.586                  6.75
## # … with 4,618 more rows, and abbreviated variable name
## #   ¹​primary_energy_consumption</code></pre>
<pre class="r"><code>correlation_matrix &lt;- round(cor(co2_data2),1)
corrp.mat &lt;- cor_pmat(co2_data2)
ggcorrplot(correlation_matrix, method =&quot;square&quot;)</code></pre>
<p><img src="/analysis_files/figure-html/unnamed-chunk-1-6.png" width="672" /></p>
<pre class="r"><code>library(dplyr)
library(tidyverse)
Agri &lt;- read_csv(&quot;FAOSTAT.csv&quot;, show_col_types = FALSE) 

Agri_land &lt;- 
  Agri %&gt;% 
  filter(str_detect(Item,&quot;Emissions on agricultural land&quot;)) %&gt;%
  filter(str_detect(Element, &quot;CO2eq&quot;)) %&gt;%
  mutate(unit = &quot;tonnes&quot;) %&gt;%
  select(Area, Item, Element, unit, Y1990:Y2018) %&gt;%
  pivot_longer(c(Y1990:Y2018),
               names_to = &quot;year&quot;, values_to = &quot;emission&quot;) %&gt;%
  mutate(total = emission * 1000) %&gt;%
  select(-emission) %&gt;%
  arrange(order(year)) %&gt;%
  group_by(year, Item, Area) %&gt;%
  summarize(sum_emission = sum(total, na.rm = TRUE, count = n()), Element) %&gt;%
  rename(Country = Area, Emission = sum_emission, source_of_emissions = Item, `Element(tonnes)` = Element) %&gt;%
  mutate(year = gsub(&quot;Y&quot;, &quot;&quot;, year)) %&gt;%
  select(-Country) %&gt;%
  ungroup() %&gt;%
  select(-`Element(tonnes)`)%&gt;%
  group_by(Country,year, source_of_emissions) %&gt;%
  summarise(Emissions = sum(Emission)) %&gt;%
  rename(country = Country) %&gt;%
  mutate(country = gsub(&quot;United Kingdom of Great Britain and Northern Ireland&quot;, &quot;United Kingdom&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;United States of America&quot;, &quot;United States&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Russian Federation&quot;, &quot;Russia&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Bolivia (Plurinational State of)&quot;, &quot;Bolivia&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Republic of Moldova&quot;, &quot;Moldova&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Lao People&#39;s Democratic Republic&quot;, &quot;Laos&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Syrian Arab Republic&quot;, &quot;Syria&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;United Republic of Tanzania&quot;, &quot;Tanzania&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Democratic Republic of the Congo&quot;, &quot;Democratic Republic of Congo&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Iran (Islamic Republic of)&quot;, &quot;Iran&quot;, country))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;Item&#39;, &#39;Area&#39;. You can override
## using the `.groups` argument.
## Adding missing grouping variables: `Country`
## `summarise()` has grouped output by &#39;Country&#39;, &#39;year&#39;. You can override using
## the `.groups` argument.</code></pre>
<pre class="r"><code>Agri_land$year = as.numeric(Agri_land$year)
Agri_land</code></pre>
<pre><code>## # A tibble: 8,149 × 4
## # Groups:   country, year [8,149]
##    country      year source_of_emissions            Emissions
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;                              &lt;dbl&gt;
##  1 Afghanistan  1990 Emissions on agricultural land 51478796.
##  2 Afghanistan  1991 Emissions on agricultural land 53359569.
##  3 Afghanistan  1992 Emissions on agricultural land 52948406.
##  4 Afghanistan  1993 Emissions on agricultural land 53377980.
##  5 Afghanistan  1994 Emissions on agricultural land 53840537.
##  6 Afghanistan  1995 Emissions on agricultural land 56579957.
##  7 Afghanistan  1996 Emissions on agricultural land 63100684.
##  8 Afghanistan  1997 Emissions on agricultural land 69216291.
##  9 Afghanistan  1998 Emissions on agricultural land 74177975.
## 10 Afghanistan  1999 Emissions on agricultural land 80778458.
## # … with 8,139 more rows</code></pre>
<pre class="r"><code>write_csv(Agri_land, file = here::here(&quot;dataset&quot;, &quot;Agri_land_clean.csv&quot;))


knitr::kable(head(Agri_land[, 1:4]), caption = &quot;The CO2 emissions in agriculral usage in United States.&quot;, &quot;simple&quot;)</code></pre>
<table>
<caption><span id="tab:unnamed-chunk-2">Table 1: </span>The CO2 emissions in agriculral usage in United States.</caption>
<thead>
<tr class="header">
<th align="left">country</th>
<th align="right">year</th>
<th align="left">source_of_emissions</th>
<th align="right">Emissions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">1990</td>
<td align="left">Emissions on agricultural land</td>
<td align="right">51478796</td>
</tr>
<tr class="even">
<td align="left">Afghanistan</td>
<td align="right">1991</td>
<td align="left">Emissions on agricultural land</td>
<td align="right">53359569</td>
</tr>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">1992</td>
<td align="left">Emissions on agricultural land</td>
<td align="right">52948406</td>
</tr>
<tr class="even">
<td align="left">Afghanistan</td>
<td align="right">1993</td>
<td align="left">Emissions on agricultural land</td>
<td align="right">53377980</td>
</tr>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">1994</td>
<td align="left">Emissions on agricultural land</td>
<td align="right">53840537</td>
</tr>
<tr class="even">
<td align="left">Afghanistan</td>
<td align="right">1995</td>
<td align="left">Emissions on agricultural land</td>
<td align="right">56579957</td>
</tr>
</tbody>
</table>
<pre class="r"><code>co2_agri &lt;- full_join(co2_data1, Agri_land, by = c(&quot;year&quot;, &quot;country&quot;))
co2_agri</code></pre>
<pre><code>## # A tibble: 8,381 × 10
##    country  year popul…¹     gdp energ…² energ…³ prima…⁴ total…⁵ sourc…⁶ Emiss…⁷
##    &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;
##  1 Afghan…  1990  1.07e7 1.31e10   2968.   2.43    31.7     9.58 Emissi…  5.15e7
##  2 Afghan…  1991  1.07e7 1.20e10   1294.   1.15    13.9     9.81 Emissi…  5.34e7
##  3 Afghan…  1992  1.21e7 1.27e10    760.   0.723    9.17    9.03 Emissi…  5.29e7
##  4 Afghan…  1993  1.40e7 9.83e 9    650.   0.926    9.10    9.11 Emissi…  5.34e7
##  5 Afghan…  1994  1.55e7 7.92e 9    570.   1.11     8.82    9.15 Emissi…  5.38e7
##  6 Afghan…  1995  1.64e7 1.23e10    452.   0.604    7.43    9.58 Emissi…  5.66e7
##  7 Afghan…  1996  1.71e7 1.21e10    426.   0.604    7.29   10.6  Emissi…  6.31e7
##  8 Afghan…  1997  1.78e7 1.19e10    390.   0.585    6.94   11.6  Emissi…  6.92e7
##  9 Afghan…  1998  1.85e7 1.17e10    365.   0.577    6.75   12.4  Emissi…  7.42e7
## 10 Afghan…  1999  1.93e7 1.15e10    350.   0.586    6.75   13.3  Emissi…  8.08e7
## # … with 8,371 more rows, and abbreviated variable names ¹​population,
## #   ²​energy_per_capita, ³​energy_per_gdp, ⁴​primary_energy_consumption,
## #   ⁵​total_ghg, ⁶​source_of_emissions, ⁷​Emissions</code></pre>
<pre class="r"><code>co2_agri &lt;- co2_agri %&gt;% 
  mutate(total_ghg2 = total_ghg * 1000) %&gt;%
  select(-total_ghg) %&gt;%
  rename(`Agriculture_emissions(kilotonnes)` = Emissions, `total_ghg(kilotonnes)` = total_ghg2)
co2_agri &lt;- co2_agri %&gt;% mutate(agri_ghg_total = rowSums(co2_agri[,c(9,10)])) %&gt;% 
  na.omit()

co2_agri</code></pre>
<pre><code>## # A tibble: 4,396 × 11
##    country  year popul…¹     gdp energ…² energ…³ prima…⁴ sourc…⁵ Agric…⁶ total…⁷
##    &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghan…  1990  1.07e7 1.31e10   2968.   2.43    31.7  Emissi…  5.15e7    9580
##  2 Afghan…  1991  1.07e7 1.20e10   1294.   1.15    13.9  Emissi…  5.34e7    9810
##  3 Afghan…  1992  1.21e7 1.27e10    760.   0.723    9.17 Emissi…  5.29e7    9030
##  4 Afghan…  1993  1.40e7 9.83e 9    650.   0.926    9.10 Emissi…  5.34e7    9110
##  5 Afghan…  1994  1.55e7 7.92e 9    570.   1.11     8.82 Emissi…  5.38e7    9150
##  6 Afghan…  1995  1.64e7 1.23e10    452.   0.604    7.43 Emissi…  5.66e7    9580
##  7 Afghan…  1996  1.71e7 1.21e10    426.   0.604    7.29 Emissi…  6.31e7   10610
##  8 Afghan…  1997  1.78e7 1.19e10    390.   0.585    6.94 Emissi…  6.92e7   11580
##  9 Afghan…  1998  1.85e7 1.17e10    365.   0.577    6.75 Emissi…  7.42e7   12400
## 10 Afghan…  1999  1.93e7 1.15e10    350.   0.586    6.75 Emissi…  8.08e7   13280
## # … with 4,386 more rows, 1 more variable: agri_ghg_total &lt;dbl&gt;, and
## #   abbreviated variable names ¹​population, ²​energy_per_capita,
## #   ³​energy_per_gdp, ⁴​primary_energy_consumption, ⁵​source_of_emissions,
## #   ⁶​`Agriculture_emissions(kilotonnes)`, ⁷​`total_ghg(kilotonnes)`</code></pre>
<pre class="r"><code>write_csv(co2_agri, file = here::here(&quot;dataset&quot;, &quot;co2_agri_clean.csv&quot;))
save(co2_agri, file = here::here(&quot;dataset/co2_agri_clean.RData&quot;))</code></pre>
