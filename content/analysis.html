---
title: Analysis
description:
toc: true
featuredVideo:
featuredImage: https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg
draft: false
---


<div id="TOC">

</div>

<p>This comes from the file <code>content/analysis.Rmd</code>.</p>
<p>We describe here our detailed data analysis.</p>
<pre class="r"><code>library(here)</code></pre>
<pre><code>## here() starts at /Users/lindasun/Desktop/MA415/ma4615-fa22-final-project-the_a-_team</code></pre>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages
## ───────────────────────────────────────
## tidyverse 1.3.2 ──</code></pre>
<pre><code>## ✔ ggplot2 3.4.0      ✔ purrr   0.3.5 
## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
## ✔ tidyr   1.2.1      ✔ stringr 1.4.1 
## ✔ readr   2.1.3      ✔ forcats 0.5.2 
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(dplyr)
co2_data &lt;- read_csv(&quot;owid-co2-data.csv&quot;, show_col_types = FALSE)

co2_data1 &lt;- co2_data %&gt;%
   select(country, year, population, gdp, energy_per_capita, energy_per_gdp, primary_energy_consumption, total_ghg) %&gt;%
  na.omit() 

co2_data1</code></pre>
<pre><code>## # A tibble: 4,628 × 8
##    country      year population         gdp energy_per…¹ energ…² prima…³ total…⁴
##    &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghanistan  1990   10694804 13065984000        2968.   2.43    31.7     9.58
##  2 Afghanistan  1991   10745168 12047362048        1294.   1.15    13.9     9.81
##  3 Afghanistan  1992   12057436 12677538816         760.   0.723    9.17    9.03
##  4 Afghanistan  1993   14003764  9834580992         650.   0.926    9.10    9.11
##  5 Afghanistan  1994   15455560  7919857152         570.   1.11     8.82    9.15
##  6 Afghanistan  1995   16418911 12307525632         452.   0.604    7.43    9.58
##  7 Afghanistan  1996   17106600 12070125568         426.   0.604    7.29   10.6 
##  8 Afghanistan  1997   17788818 11850752000         390.   0.585    6.94   11.6 
##  9 Afghanistan  1998   18493134 11692172288         365.   0.577    6.75   12.4 
## 10 Afghanistan  1999   19262854 11517317120         350.   0.586    6.75   13.3 
## # … with 4,618 more rows, and abbreviated variable names ¹​energy_per_capita,
## #   ²​energy_per_gdp, ³​primary_energy_consumption, ⁴​total_ghg</code></pre>
<pre class="r"><code>library(dplyr)
library(tidyverse)
Agri &lt;- read_csv(&quot;FAOSTAT.csv&quot;, show_col_types = FALSE) 

Agri_land &lt;- 
  Agri %&gt;% 
  filter(str_detect(Item,&quot;Emissions on agricultural land&quot;)) %&gt;%
  filter(str_detect(Element, &quot;CO2eq&quot;)) %&gt;%
  mutate(unit = &quot;tonnes&quot;) %&gt;%
  select(Area, Item, Element, unit, Y1990:Y2018) %&gt;%
  pivot_longer(c(Y1990:Y2018),
               names_to = &quot;year&quot;, values_to = &quot;emission&quot;) %&gt;%
  mutate(total = emission * 1000) %&gt;%
  select(-emission) %&gt;%
  arrange(order(year)) %&gt;%
  group_by(year, Item, Area) %&gt;%
  summarize(sum_emission = sum(total, na.rm = TRUE, count = n()), Element) %&gt;%
  rename(Country = Area, Emission = sum_emission, source_of_emissions = Item, `Element(tonnes)` = Element) %&gt;%
  mutate(year = gsub(&quot;Y&quot;, &quot;&quot;, year)) %&gt;%
  select(-Country) %&gt;%
  ungroup() %&gt;%
  select(-`Element(tonnes)`)%&gt;%
  group_by(Country,year, source_of_emissions) %&gt;%
  summarise(Emissions = sum(Emission)) %&gt;%
  rename(country = Country) %&gt;%
  mutate(country = gsub(&quot;United Kingdom of Great Britain and Northern Ireland&quot;, &quot;United Kingdom&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;United States of America&quot;, &quot;United States&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Russian Federation&quot;, &quot;Russia&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Bolivia (Plurinational State of)&quot;, &quot;Bolivia&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Republic of Moldova&quot;, &quot;Moldova&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Lao People&#39;s Democratic Republic&quot;, &quot;Laos&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Syrian Arab Republic&quot;, &quot;Syria&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;United Republic of Tanzania&quot;, &quot;Tanzania&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Democratic Republic of the Congo&quot;, &quot;Democratic Republic of Congo&quot;, country)) %&gt;%
  mutate(country = gsub(&quot;Iran (Islamic Republic of)&quot;, &quot;Iran&quot;, country))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;, &#39;Item&#39;, &#39;Area&#39;. You can override
## using the `.groups` argument.
## Adding missing grouping variables: `Country`
## `summarise()` has grouped output by &#39;Country&#39;, &#39;year&#39;. You can override using
## the `.groups` argument.</code></pre>
<pre class="r"><code>Agri_land$year = as.numeric(Agri_land$year)
Agri_land</code></pre>
<pre><code>## # A tibble: 8,149 × 4
## # Groups:   country, year [8,149]
##    country      year source_of_emissions            Emissions
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;                              &lt;dbl&gt;
##  1 Afghanistan  1990 Emissions on agricultural land 51478796.
##  2 Afghanistan  1991 Emissions on agricultural land 53359569.
##  3 Afghanistan  1992 Emissions on agricultural land 52948406.
##  4 Afghanistan  1993 Emissions on agricultural land 53377980.
##  5 Afghanistan  1994 Emissions on agricultural land 53840537.
##  6 Afghanistan  1995 Emissions on agricultural land 56579957.
##  7 Afghanistan  1996 Emissions on agricultural land 63100684.
##  8 Afghanistan  1997 Emissions on agricultural land 69216291.
##  9 Afghanistan  1998 Emissions on agricultural land 74177975.
## 10 Afghanistan  1999 Emissions on agricultural land 80778458.
## # … with 8,139 more rows</code></pre>
<pre class="r"><code>write_csv(Agri_land, file = here::here(&quot;dataset&quot;, &quot;Agri_land_clean.csv&quot;))</code></pre>
<pre class="r"><code>co2_agri &lt;- full_join(co2_data1, Agri_land, by = c(&quot;year&quot;, &quot;country&quot;))
co2_agri$year &lt;- as.character(co2_agri$year)

co2_agri &lt;- co2_agri %&gt;% 
  mutate(total_ghg2 = total_ghg * 1000) %&gt;%
  select(-total_ghg) %&gt;%
  filter(country != &quot;World&quot;) %&gt;%
  rename(`Agriculture_emissions(kilotonnes)` = Emissions, `total_ghg(kilotonnes)` = total_ghg2)
co2_agri &lt;- co2_agri %&gt;% mutate(agri_ghg_total = rowSums(co2_agri[,c(9,10)])) %&gt;% 
  na.omit()

co2_agri</code></pre>
<pre><code>## # A tibble: 4,390 × 11
##    country year  popul…¹     gdp energ…² energ…³ prima…⁴ sourc…⁵ Agric…⁶ total…⁷
##    &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1 Afghan… 1990   1.07e7 1.31e10   2968.   2.43    31.7  Emissi…  5.15e7    9580
##  2 Afghan… 1991   1.07e7 1.20e10   1294.   1.15    13.9  Emissi…  5.34e7    9810
##  3 Afghan… 1992   1.21e7 1.27e10    760.   0.723    9.17 Emissi…  5.29e7    9030
##  4 Afghan… 1993   1.40e7 9.83e 9    650.   0.926    9.10 Emissi…  5.34e7    9110
##  5 Afghan… 1994   1.55e7 7.92e 9    570.   1.11     8.82 Emissi…  5.38e7    9150
##  6 Afghan… 1995   1.64e7 1.23e10    452.   0.604    7.43 Emissi…  5.66e7    9580
##  7 Afghan… 1996   1.71e7 1.21e10    426.   0.604    7.29 Emissi…  6.31e7   10610
##  8 Afghan… 1997   1.78e7 1.19e10    390.   0.585    6.94 Emissi…  6.92e7   11580
##  9 Afghan… 1998   1.85e7 1.17e10    365.   0.577    6.75 Emissi…  7.42e7   12400
## 10 Afghan… 1999   1.93e7 1.15e10    350.   0.586    6.75 Emissi…  8.08e7   13280
## # … with 4,380 more rows, 1 more variable: agri_ghg_total &lt;dbl&gt;, and
## #   abbreviated variable names ¹​population, ²​energy_per_capita,
## #   ³​energy_per_gdp, ⁴​primary_energy_consumption, ⁵​source_of_emissions,
## #   ⁶​`Agriculture_emissions(kilotonnes)`, ⁷​`total_ghg(kilotonnes)`</code></pre>
<pre class="r"><code>write_csv(co2_agri, file = here::here(&quot;dataset&quot;, &quot;co2_agri_clean.csv&quot;))
view(co2_agri[1:4396,1:10])</code></pre>
<pre class="r"><code>co2_total &lt;- co2_agri %&gt;%
  filter(country != &quot;World&quot;) %&gt;%
  ggplot(aes(year,`agri_ghg_total`)) +
  geom_line() +
  theme(axis.text.x = element_text(size=7, angle=45, vjust=0.8, hjust=0.8)) +
  labs(x = &quot;Year&quot;, y = &quot;Global Total Emission&quot;) 

co2_total</code></pre>
<p><img src="/analysis_files/figure-html/totalline-1.png" width="672" /></p>
<pre class="r"><code>co2_prop &lt;- co2_agri %&gt;%
  group_by(country) %&gt;%
  summarise(n1 = sum(agri_ghg_total)) %&gt;%
  mutate(prop = n1/sum(n1)) %&gt;%
  arrange(desc(prop))%&gt;%
  head(10) %&gt;%
  select(-n1)

co2_prop</code></pre>
<pre><code>## # A tibble: 10 × 2
##    country                        prop
##    &lt;chr&gt;                         &lt;dbl&gt;
##  1 Brazil                       0.136 
##  2 China                        0.0899
##  3 India                        0.0865
##  4 Indonesia                    0.0803
##  5 United States                0.0613
##  6 Zambia                       0.0339
##  7 Democratic Republic of Congo 0.0324
##  8 Australia                    0.0244
##  9 Argentina                    0.0234
## 10 Russia                       0.0231</code></pre>
<pre class="r"><code>co2_facet &lt;- co2_agri %&gt;% 
  filter(country == &quot;China&quot; | country == &quot;Brazil&quot; | country == &quot;India&quot; | country == &quot;Indonesia&quot; | country == &quot;United States&quot;|country == &quot;Zambia&quot;|country ==&quot;Democratic Republic of Congo&quot; |country==&quot;Australia&quot;|country == &quot;Argentina&quot;)%&gt;%
  select(country, year, population, agri_ghg_total)%&gt;%
  ggplot(aes(year, agri_ghg_total, color = country)) +
    geom_line() +
    facet_wrap(vars(country)) +
    labs(title = &quot;Emissions vs year of top ten countries&quot;,
         x = &quot;Year&quot;,
         y = &quot;Total Emissions&quot;) +
    theme_bw()
co2_facet</code></pre>
<pre><code>## `geom_line()`: Each group consists of only one observation.
## ℹ Do you need to adjust the group aesthetic?
## `geom_line()`: Each group consists of only one observation.
## ℹ Do you need to adjust the group aesthetic?
## `geom_line()`: Each group consists of only one observation.
## ℹ Do you need to adjust the group aesthetic?
## `geom_line()`: Each group consists of only one observation.
## ℹ Do you need to adjust the group aesthetic?
## `geom_line()`: Each group consists of only one observation.
## ℹ Do you need to adjust the group aesthetic?
## `geom_line()`: Each group consists of only one observation.
## ℹ Do you need to adjust the group aesthetic?
## `geom_line()`: Each group consists of only one observation.
## ℹ Do you need to adjust the group aesthetic?
## `geom_line()`: Each group consists of only one observation.
## ℹ Do you need to adjust the group aesthetic?
## `geom_line()`: Each group consists of only one observation.
## ℹ Do you need to adjust the group aesthetic?</code></pre>
<p><img src="/analysis_files/figure-html/facet-1.png" width="672" /></p>
<pre class="r"><code>co2_prop &lt;- co2_agri %&gt;%
  filter(country != &quot;World&quot;) %&gt;%
  group_by(country) %&gt;%
  summarise(n1 = sum(agri_ghg_total)) %&gt;%
  mutate(prop = n1/sum(n1)) %&gt;%
  arrange(desc(prop))%&gt;%
  head(10) %&gt;%
  select(-n1)
co2_prop</code></pre>
<pre><code>## # A tibble: 10 × 2
##    country                        prop
##    &lt;chr&gt;                         &lt;dbl&gt;
##  1 Brazil                       0.136 
##  2 China                        0.0899
##  3 India                        0.0865
##  4 Indonesia                    0.0803
##  5 United States                0.0613
##  6 Zambia                       0.0339
##  7 Democratic Republic of Congo 0.0324
##  8 Australia                    0.0244
##  9 Argentina                    0.0234
## 10 Russia                       0.0231</code></pre>
<pre class="r"><code>co2_bar &lt;- co2_prop %&gt;%
  filter(country == &quot;China&quot; | country == &quot;Brazil&quot; | country == &quot;India&quot; | country == &quot;Indonesia&quot; | country == &quot;United States&quot;) %&gt;%
  ggplot(aes(x = country, y = prop, fill = country)) +
  geom_bar(stat=&quot;identity&quot;, width=1) +
  geom_text(aes(label = prop), vjust = 0) +
  labs(x = &quot;Country&quot;, y = &quot;Total Emissions&quot;)

co2_bar</code></pre>
<p><img src="/analysis_files/figure-html/bar-1.png" width="672" /></p>
<pre class="r"><code>co2_bubble &lt;- co2_agri %&gt;%
  filter(country == &quot;China&quot; | country == &quot;Brazil&quot; | country == &quot;India&quot; | country == &quot;Indonesia&quot; | country == &quot;United States&quot;) %&gt;%
  arrange(desc(agri_ghg_total)) %&gt;%
  ggplot(aes(x= gdp, y= agri_ghg_total, size= population, color=country)) +
    geom_point(alpha=0.5) +
    scale_size(range = c(.1, 10), name=&quot;Total emissions&quot;) +
  labs(x = &quot;GDP&quot;, y = &quot;Total Emissions&quot;)

co2_bubble</code></pre>
<p><img src="/analysis_files/figure-html/bubble-1.png" width="672" /></p>
<pre class="r"><code>co2_box &lt;- co2_agri %&gt;% 
  filter(country == &quot;China&quot; | country == &quot;Brazil&quot; | country == &quot;India&quot; | country == &quot;Indonesia&quot; | country == &quot;United States&quot;) %&gt;%
  ggplot(aes(country, primary_energy_consumption)) + 
  geom_boxplot(aes(fill=country, alpha = 0)) + 
  geom_jitter(alpha = 0.3, color = &quot;Tomato&quot;) +
  labs(x = &quot;Country&quot;, 
       y = &quot;Primary Energy Consumption&quot;, 
       fill=&#39;Years&#39;, 
       title= &#39;Top 5 total emission&#39;) +
  coord_flip()
 co2_box</code></pre>
<p><img src="/analysis_files/figure-html/boxplot-1.png" width="672" /></p>
<pre class="r"><code>co2_bubble2 &lt;- co2_agri %&gt;%
  filter(country == &quot;China&quot; | country == &quot;Brazil&quot; | country == &quot;India&quot; | country == &quot;Indonesia&quot; | country == &quot;United States&quot;) %&gt;%
  arrange(desc(agri_ghg_total)) %&gt;%
  ggplot(aes(x= energy_per_gdp, y= agri_ghg_total, size= gdp, color=country)) +
    geom_point(alpha=0.5) +
    scale_size(range = c(.1, 10), name=&quot;Total emissions&quot;) +
  labs(x = &quot;Energy per GDP&quot;, y = &quot;Total Emission&quot;)

co2_bubble2</code></pre>
<p><img src="/analysis_files/figure-html/bubble2-1.png" width="672" /></p>
<pre class="r"><code>co2_line &lt;- co2_agri %&gt;%
  filter(country == &quot;China&quot; | country == &quot;Brazil&quot; | country == &quot;India&quot; | country == &quot;Indonesia&quot; | country == &quot;United States&quot;) %&gt;%
  ggplot(aes(energy_per_capita,agri_ghg_total, color = country)) +
  geom_point() +
  geom_line()+
  labs(x = &quot;Energy per capita&quot;, y = &quot;Total Emissions&quot;)

co2_line</code></pre>
<p><img src="/analysis_files/figure-html/line-1.png" width="672" /></p>
